<img src="https://github.com/peekaboo-dex/contracts/blob/main/peekaboo.png" width="35%" height="35%" />

# Summary
Peekaboo is a blind NFT auction built on Ethereum. Bids are sealed using assymetric encryption, where the secret key is revealed by solving a verifiable-delay function (VDF). The secret key is published on-chain to close the auction. This allows anyone to reveal all bids after the auction is closed. Only one reveal is required on-chain, which is to declare the winning bid. Our auction has a lower amortized cost and more seamless user-experience than existing NFT auctions on Ethereum. This is made possible by the novel 2021 <a href="https://eprint.iacr.org/2021/1293.pdf" target="_blank">TIDE Encryption Scheme</a>, which we adapted to Ethereum by decrypting in a smart contract. 

Our logo was generated by <a href="https://openai.com/dall-e-2/" target="_blank">DALL-E 2 AI</a> using the seedphrase, "peekaboo cute pink logo with cute kawaii style animal"

# How it Works

### Creating an Auction
1.	Generate a public key and puzzle (using scripts in python folder).
2.	Send NFT, Public Key, Puzzle to our smart contract via the `createAuction(nftAddress, nftId, publicKey, puzzle)` function. The inputs are emitted as an event.
3.	The auction is now in session!

### Bidding on an Auction
1.	Encrypt your bid using the auction's Public Key (that was emitted when the auction was created).
2.	Send your sealed bid to the smart contract along with \*obfuscated ETH, via the `commitBid(auctionId, sealedBid)` function.
3.	The sealed bid is emitted in an event.

\* obfuscated ETH = bid + α, where α is always refunded.

### Closing an Auction
Anyone can solve the auction's Puzzle (which was emitted in an event when the auction was created). Solving the puzzle reveals the secret key, which can be used to decrypt all of the sealed bids simultaneously. To close the auction:
1. Call the smart contract function `closeAuction(auctionId, <secret key parameters...>)` with the solution to the auction's Puzzle.
2. The solution is verified on-chain and emitted in an event.

### Revealing the Winner
Anyone can reveal any bid once the auction has been closed using the emitted secret key. There is a fixed period of time after the auction is closed to reveal the winner. 
1. Call the smart contract function `revealBid(auctionId, bidderAddress)`
2. The smart contract unseals the bid committed by `bidderAddress` using the auction's secret key.
3. The revealed bid is assigned as the winning bid iff it is higher than the existing revealed bid. Note that since anyone can decrypt any sealed bid off-chain, it is only necessary to reveal the winning bid to the smart contract. Revealing any lower bid is a waste of ETH as anyone can simply overwrite it. 

### Finalizing the Auction
1. Call the smart contract function `finalizeAuction(auctionId)`
2. This settles the auction by sending the NFT to the winner and the bid to the auctioneer. If no bids took place then the NFT is refunded.

### Refunds
The bidders who did not win the auction receive a full refund after the auction has been finalized.
1. Call the smart contract function `claimRefund(auctionId)`.

# Future Work

There are interesting incentive models to be explored in this ecosystem. For example, a Peekaboo utility token could be used to pay for VDF solvers.

# Developers

### Solidity Dependencies
We use foundry and test using the Demo and the Goerli testnet

### Python Dependencies for Demo and Cryptography library
```
pip3 install sympy
pip3 install gaussianprimes
pip3 uninstall pycrypto # Ensure this is not installed
pip3 install pycryptodome
pip3 install w3
pip3 install web3
```

### Deploying the smart contracts
```
./deploy.sh <private key>
```

### Command-Line Tests (on Goerli testnet)
This is truns the end-to-end workflow on the Goerli testnet:
1. Creates an auction
2. Commits 4 sealed bids
3. Solves the cryptographic puzzle to reveal the secret key
4. Reveals the winning bid
5. Finalizes the auction (settlement)

```
python3 python/main.py demo --contract 0x397B9515A053c70620a34a4B92bc049F0e31F0da
```

### Test Expected Output
<img src="https://github.com/peekaboo-dex/contracts/blob/main/demo_output.png" />

# Web Interface Demo

Our web interface demo is in the [interface](https://github.com/peekaboo-dex/interface) repository.